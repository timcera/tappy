<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
  <head>
    <meta name="generator" content=
    "HTML Tidy for Linux/x86 (vers 1st April 2002), see www.w3.org">

    <title>Astrolabe: Astronomical subroutines and
    applications</title>
  </head>

  <body>
    <h1 align="center">Astrolabe: Astronomical subroutines and
    applications</h1>
    Last updated: July 4, 2005. 

    <p>Best Viewed With <a href=
    "http://www.anybrowser.org/campaign/">Any Browser</a>.</p>

    <h1>Introduction</h1>

    <blockquote>
      <strong>Astrolabe</strong> is a collection of subroutines and
      applications for calculating the positions of the sun, moon,
      planets and other celestial objects. The emphasis is on high
      accuracy over a several thousand year time span. Note that
      the techniques used are overkill for most calendar
      applications. See the FAQ, <a href=
      "http://home.salamander.com/~wmcclain/astro_calc.html">Astronomical
      Calculations for the Amateur</a> for pointers to other
      methods which are both faster and smaller in terms of code
      bulk. 

      <p>The subroutine library attempts to (someday) implement all
      the techniques described in <cite>Astronomical
      Algorithms</cite>, second edition 1998, by Jean Meeus, <a
      href="http://www.willbell.com/">Willmann-Bell, Inc</a>. For
      an alternative open-source implementation of Meeus in ANSI C,
      look <a href=
      "http://www.christophedavid.org/AstronomicalAlgorithms/AstronomicalAlgorithms_Intro.htm">
      here</a>.</p>

      <p>Currently there are no graphical applications apart from
      some demo CGI interfaces. I may add graphics in the future,
      but I don't intend to create a planetarium program. For a
      very nice open-source example of such running on Unix/Linux
      systems, see <a href=
      "http://www.ClearSkyInstitute.com/xephem/xephem.html">XEphem</a>.
      Graphical software for many platforms are linked at <a href=
      "http://www.seds.org/billa/astrosoftware.html">Planetarium
      Software</a>.</p>

      <p>The Astrolabe source is licensed under the GPL, meaning it
      can be copied and distributed freely.</p>
    </blockquote>

    <h1>Sources</h1>

    <blockquote>
      As a general rule, I have implemented all the sources in more
      than one language. Currently, the source languages are: 

      <ul>
        <li><a href="http://www.python.org/">Python</a></li>

        <li>C++</li>
      </ul>
      These applications are compute-intensive and are perhaps not
      the best use of an interpreted language like Python, but with
      modern hardware the Python versions perform well enough for
      many uses. The C++ versions are about 20-25 times faster. 

      <p>The sources are available for download from the
      SourceForge <a href=
      "http://sourceforge.net/projects/astrolabe/">Summary
      Page</a>.</p>
    </blockquote>

    <h1>Getting started</h1>

    <blockquote>
      Unpack the files into some convenient location. Everything is
      under a top-level directory <strong>astrolabe</strong>. If
      you have a previous astrolabe_params.txt, you should first
      copy it out of this directory tree so that your local
      modifications are not lost. 

      <ul>
        <li>
          Linux/Unix 

          <p>In the following examples I presume
          <strong>astrolabe</strong> is directly under your home
          directory "~".</p>

          <p>Edit <strong>~/astrolabe/astrolabe_params.txt</strong>
          and enter your own longitude and latitude. There are some
          file path strings which you should modify to match your
          local directory structure.</p>

          <p>Set PYTHONPATH to include the Astrolabe library:</p>

          <blockquote>
            <tt>export
            PYTHONPATH=$PYTHONPATH:~/astrolabe/lib/python</tt>
          </blockquote>

          <p>Set a symbol to reference the Astrolabe parameter
          file:</p>

          <blockquote>
            <tt>export
            ASTROLABE_PARAMS=~/astrolabe/astrolabe_params.txt</tt>
          </blockquote>

          <p>Run some of the sample applications under
          astrolabe/apps/python.</p>

          <p>For C++: the makefile is in astrolabe/apps/cpp. Go to
          that directory and do:</p>

          <blockquote>
            <tt>make all</tt>
          </blockquote>
        </li>

        <li>
          Microsoft 

          <p><strong>Warning</strong>: My MS knowledge is years out
          of date. This installation method worked on NT around
          2001 but I don't have more recent experience. .</p>

          <p>This is how I run the Python applications under NT.
          The example presumes <strong>astrolabe</strong> is a
          top-level folder on the C: drive.</p>

          <p>Use Start-&gt;Control
          Panels-&gt;System-&gt;Environment to create a new User
          Variable.</p>

          <blockquote>
            <table border summary="Environment settings">
              <tr>
                <th>Variable</th>

                <th>Value</th>
              </tr>

              <tr>
                <td><tt>ASTROLABE_PARAMS</tt></td>

                <td><tt>c:\astrolabe\astrolabe_params.txt</tt></td>
              </tr>
            </table>
          </blockquote>
          I believe you have to log out and in again. 

          <p>Use regedit (be careful!) to create a new key under
          HKEY_LOCAL_MACHINE -&gt; SOFTWARE -&gt; Python -&gt;
          PythonCore -&gt; 1.5 (or other version) -&gt; PythonPath.
          Create a new key "astrolabe" with name = "(Default)" and
          value = "c:\astrolabe\lib\python".</p>

          <p>Run PythonWin. Edit
          <strong>c:\astrolabe\astrolabe_params.txt</strong> and
          enter your own longitude and latitude. There are some
          file path strings which you should modify to match your
          local directory structure.</p>

          <p>Still in PythonWin, Use File-&gt;Run to execute
          applications in the c:\astrolabe\apps\python folder.</p>

          <p>For C++: (to do: provide a makefile or workspace file
          [?]. Until then, create each app as a DOS console
          application and add the subroutine sources).</p>
        </li>
      </ul>
    </blockquote>

    <h1>Models and accuracy</h1>

    <blockquote>
      <strong>Mercury through Neptune</strong> 

      <blockquote>
        <p><strong>Model</strong>. The planetary model is VSOP87
        (<em>Variations Seculaires des Orbites Planetaires</em>) by
        Bretagnon and Francou. The original model documentation,
        data files, and sample Fortran routines are available <a
        href=
        "http://cdsweb.u-strasbg.fr/cgi-bin/Cat?VI/81">here</a>.
        <strong>NOTE</strong>: It is <strong>not</strong>
        neccessary to download any data or sources from the
        original site. I have provided everything required. The
        original data files require about 4.1 MB; I have combined
        and reduced these to about 1.4 MB. The full accuracy of the
        model is retained.</p>

        <p><strong>Version</strong>. The VSOP model is available in
        several variants. I am using version "D" which produces
        heliocentric spherical coordinates for the equinox of date.
        This is the same as used in Meeus.</p>

        <p><strong>Accuracy</strong>. The model produces positions
        of better than 1 arc-second for Mercury through Mars for
        the years -2000 to +4000, for Jupiter and Saturn for the
        years 0 to +4000, and for Uranus and Neptune for the years
        -4000 to +8000. Within those ranges, the actual accuracies
        are:</p>

        <blockquote>
          <table border summary="Accuracy of planetary positions">
            <tr>
              <th>
              </th>

              <th>distance to Sun (km)</th>

              <th>longitude &amp; latitude (arc-seconds)</th>
            </tr>

            <tr>
              <td>Mercury</td>

              <td>0.3</td>

              <td>0.001</td>
            </tr>

            <tr>
              <td>Venus</td>

              <td>2.7</td>

              <td>0.005</td>
            </tr>

            <tr>
              <td>Earth</td>

              <td>3.7</td>

              <td>0.005</td>
            </tr>

            <tr>
              <td>Mars</td>

              <td>22.8</td>

              <td>0.021</td>
            </tr>

            <tr>
              <td>Jupiter</td>

              <td>272</td>

              <td>0.072</td>
            </tr>

            <tr>
              <td>Saturn</td>

              <td>1000</td>

              <td>0.144</td>
            </tr>

            <tr>
              <td>Uranus</td>

              <td>230</td>

              <td>0.017</td>
            </tr>

            <tr>
              <td>Neptune</td>

              <td>1891</td>

              <td>0.087</td>
            </tr>
          </table>
        </blockquote>

        <p><strong>A note on the Meeus version</strong>. Meeus
        prints a truncated version of the model in his book. The
        first edition had an optional software supplement which
        included the truncated data. This supplement is no longer
        available, but the complete data presented here can be used
        instead of the version on the diskette. I use a different
        format.</p>
      </blockquote>
      <strong>Moon</strong> 

      <blockquote>
        The lunar model is Meeus's simplified version of ELP2000-82
        by Chapront. The complete model can be found <a href=
        "http://cdsweb.u-strasbg.fr/cgi-bin/Cat?VI/79">here</a>.
        Accuracy of the simplified version is about 10 arc-seconds
        in longitude and 4 arc-seconds in latitude. (Over what
        period?)
      </blockquote>
    </blockquote>

    <h1>Applications</h1>

    <ul>
      <li><strong>check_equinox</strong>: Check the accuracy of the
      equinox approximation routines over 4000 years.</li>

      <li><strong>check_vsop87d</strong>: Test the VSOP87d
      calculations against the check document.</li>

      <li><strong>create_binary_vsop_db</strong>: Create a binary
      version of the VSOP87d database.</li>

      <li><strong>create_text_vsop_db</strong>: Create a text
      version of the VSOP87d database.</li>

      <li><strong>cronus</strong>: A clock application that
      displays a variety of celestial events in the order they
      occur.</li>

      <li><strong><a href=
      "http://astrolabe.sourceforge.net/cgi-bin/easter-cgi.py">equinox-cgi</a></strong>:
      A demo CGI interface to the Easter routine.</li>

      <li><strong>solstice</strong>: Displays the instants of
      equinoxes and solstices for a range of years. Times are
      accurate to one second.</li>

      <li><strong><a href=
      "http://astrolabe.sourceforge.net/cgi-bin/solstice-cgi.py">solstice-cgi</a></strong>:
      A demo CGI interface to the Solstice and Equinox
      routines.</li>

      <li><strong>time_vsop_db_loads</strong>: Compare the loading
      time of text and binary VSOp87d databases.</li>

      <li><strong>validate_meeus</strong>: Validate Astrolabe
      routines against examples given in <cite>Astronomical
      Algorithms</cite> by Jean Meeus, second edition 1998,
      Willmann-Bell Inc.</li>
    </ul>

    <h1>Subroutines</h1>

    <blockquote>
      I don't have separate docs for the subroutine library yet,
      but all the modules and functions have doc strings which
      should make usage pretty clear. The applications are all
      rather simple and studying them may be instructive.
    </blockquote>

    <h1>Platforms</h1>

    <blockquote>
      I've tested on these platforms: 

      <ul>
        <li>
          Python 

          <ul>
            <li>Linux 2.4.20 (SuSE 8.2, i686), Python 2.4.1</li>
          </ul>
        </li>

        <li>
          C++ 

          <ul>
            <li>Linux 2.4.20 (SuSE 8.2, i686), gcc versions 3.3 and
            4.0.1</li>
          </ul>
        </li>
      </ul>
    </blockquote>

    <h1>Notes on programming languages</h1>

    <blockquote>
      Years ago, I originally wrote the <strong>astrolabe</strong>
      routines in C. Now, I always implement in Python first, then
      make a C++ version as a more-or-less direct translation. The
      C++ source has a lot of compromises required for
      compatability with different compilers, which are, however,
      getting closer to the standard with time. 

      <p>The Python sources are obviously more compact than the C++
      versions and have less declarative overhead. To me, the most
      unfortunate aspects of C++ are:</p>

      <ul>
        <li>STL containers cannot have initialization lists,
        meaning that inline data must first be held in C-arrays,
        then copied to the containers at run-time. I use some
        macros to make this a bit more natural-looking.</li>

        <li>Template arguments cannot be local types. That means
        STL containers must use types declared at an outer scope,
        which is ugly.</li>

        <li>
          Functions may not return multiple values. Where Python
          can have: 

          <blockquote>
            <tt>ra, dec = func()</tt>
          </blockquote>
          C++ requires: 

          <blockquote>
            <tt>void func(double &amp;ra, double &amp;dec);<br>
             double ra, dec;<br>
             func(ra, dec);</tt>
          </blockquote>
          ...or a struct for a return value, which would require
          more declarations. In an alternative C-like language,
          this would be just as strongly-typed as the function
          shown above: 

          <blockquote>
            <tt>double, double func();<br>
             double ra, double dec = func();</tt>
          </blockquote>
        </li>
      </ul>
    </blockquote>

    <h1>To do</h1>

    <blockquote>
      Add automated configure scripts for C++ compilation and
      installation. 

      <p>Improve the lunar model, perhaps with the complete
      Chapront ELP2000-82.</p>

      <p>Add more material from Meeus:</p>

      <ul>
        <li>Add a model for Pluto.</li>

        <li>Add year-by-year polynomial model for planets Jupiter
        through Neptune.</li>

        <li>Add perihelion/aphelion routines for the planets, and
        perigee/apogee routines for the Moon.</li>

        <li>Look at adjustable truncation of the VSOP model to
        trade accuracy for time.</li>
      </ul>

      <p>Fix a bug in the Rise-Set-Transit code which causes events
      around 0hr UT to be dropped.</p>

      <p>Fix a bug in cronus.py that causes equinox/solstice events
      to be reported out of order on that day. (The displayed
      values are correct, though).</p>

      <p>Improve the param file parsing so people can enter their
      longitude and latitude more naturally.</p>

      <p>Extend the Python code with C modules performing the
      expensive computations.</p>

      <p>(or...) Make a CORBA version of the subroutine library in
      C++.</p>
    </blockquote>

    <h1>Change history</h1>

    <blockquote>
      <table summary="Change History">
        <tr>
          <th>version</th>

          <th>date</th>

          <th>
          </th>
        </tr>

        <tr valign="top">
          <td>0.5</td>

          <td>2005-Jul-4</td>

          <td>Brought the code up to date to use new Python
          features and repair C++ damage caused by evolving gcc
          compliance. Added a few recent deltaT values.</td>
        </tr>

        <tr valign="top">
          <td>0.4</td>

          <td>2001-Jul-9</td>

          <td>Added GPL license text; no code changes.</td>
        </tr>

        <tr valign="top">
          <td>0.3</td>

          <td>2001-May-21</td>

          <td>Added <a href=
          "http://astrolabe.sourceforge.net/cgi-bin/easter-cgi.py">equinox-cgi</a>
          and <a href=
          "http://astrolabe.sourceforge.net/cgi-bin/solstice-cgi.py">
          solstice-cgi</a> CGI interfaces. Plus minor format
          cleanup in the C++ applications.</td>
        </tr>

        <tr valign="top">
          <td>0.2</td>

          <td>2000-Oct-1</td>

          <td>Added C++ version, small bug fixes.</td>
        </tr>

        <tr valign="top">
          <td>0.1</td>

          <td>2000-Sep-3</td>

          <td>First version on SourceForge</td>
        </tr>
      </table>
    </blockquote>
    <hr>
    <a href="mailto:wmcclain@salamander.com">Comments?</a> 

    <address>
      Bill McClain (wmcclain@salamander.com)
    </address>
    
    <p><a href="http://home.salamander.com/~wmcclain/">Bill McClain's
    Home Page</a> 

    <p><a href="http://sattre-press.com/">Sattre Press</a> 

    <p><table summary="Sourceforge logo">
      <tr>
        <td valign="top" align="left">Hosted by:</td>

        <td><a href="http://sourceforge.net/"><img src=
        "http://sourceforge.net/images/sflogo2-steel.png" width=
        "143" height="70" alt="SourceForge logo"></a></td>
      </tr>
    </table>
  </body>
</html>

